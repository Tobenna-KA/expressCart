function globalSearch(){$("#global-search-results").empty(),$.ajax({type:"POST",url:"/admin/searchall",data:{searchValue:$("#global-search-value").val()}}).done(t=>{$("#global-search").html('<i class="feather" data-feather="search"></i>');let e=!1;if(t.customers.forEach(t=>{e=!0;const a=`\n\t\t\t\t<li class="list-group-item global-result text-center" data-url="/admin/customer/view/${t._id}">\n\t\t\t\t\t<div class="row">\n\t\t\t\t\t<div class="col global-result-type gr-click"><i class="feather" data-feather="user"></i> Customer</div>\n\t\t\t\t\t<div class="col global-result-detail gr-click">${t.firstName} ${t.lastName}</div>\n\t\t\t\t\t<div class="col global-result-detail gr-click">${t.email}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</li>`;$("#global-search-results").append(a)}),t.orders.forEach(t=>{e=!0;const a=`\n            <li class="list-group-item global-result text-center" data-url="/admin/order/view/${t._id}">\n                <div class="row">\n                    <div class="col global-result-type gr-click"><i class="feather" data-feather="package"></i> Order</div>\n                    <div class="col global-result-detail gr-click">${t.orderFirstname} ${t.orderLastname}</div>\n                    <div class="col global-result-detail gr-click">${moment(t.orderDate).format("YYYY/MM/DD")}</div>\n                    <div class="col global-result-detail gr-click">${t.orderEmail}</div>\n                </div>\n            </li>`;$("#global-search-results").append(a)}),t.products.forEach(t=>{e=!0;const a=`\n\t\t\t\t<li class="list-group-item global-result text-center" data-url="/admin/product/edit/${t._id}">\n\t\t\t\t\t<div class="row">\n\t\t\t\t\t\t<div class="col global-result-type gr-click"><i class="feather" data-feather="tag"></i> Product</div>\n\t\t\t\t\t\t<div class="col global-result-detail gr-click">${t.productTitle}</div>\n\t\t\t\t\t\t<div class="col global-result-detail gr-click">${$("#currencySymbol").val()}${numeral(t.productPrice).format("0.00")}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</li>`;$("#global-search-results").append(a)}),!0===e)$("#global-search-results").removeClass("invisible");else{const t='<li class="list-group-item text-center">\n                <div class="row">\n                    <div class="col global-result-type gr-click">Nothing found</div>\n                </div>\n            </li>';$("#global-search-results").append(t),$("#global-search-results").removeClass("invisible")}feather.replace()})}function validationErrors(t){var e="";return t.forEach(t=>{e+=`<p>${t.dataPath.replace("/","")} - <span class="text-danger">${t.message}<span></p>`}),e}$(document).ready(function(){if($.ajaxSetup({headers:{"csrf-token":$('meta[name="csrfToken"]').attr("content")}}),$(document).on("click","#btnGenerateAPIkey",function(t){t.preventDefault(),$.ajax({method:"POST",url:"/admin/createApiKey"}).done(function(t){$("#apiKey").val(t.apiKey),showNotification(t.message,"success",!0)}).fail(function(t){showNotification(t.responseJSON.message,"danger")})}),$(document).on("click",".removeVariant",function(t){t.preventDefault(),$.ajax({method:"POST",url:"/admin/product/removevariant",data:{variant:$(this).attr("data-id")}}).done(function(t){showNotification(t.message,"success",!0)}).fail(function(t){showNotification(t.responseJSON.message,"danger")})}),$(document).on("click",".editVariant",function(t){t.preventDefault()}),$(document).on("click","#saveVariant",function(t){t.preventDefault(),$.ajax({method:"POST",url:"/admin/product/editvariant",data:{product:$("#variant-edit-product").val(),variant:$("#variant-edit-id").val(),title:$("#variant-edit-title").val(),price:$("#variant-edit-price").val(),productPriceUSD:$("#variant-edit-price-usd").val(),productPriceCFA:$("#variant-edit-price-cfa").val(),productPriceEUR:$("#variant-edit-price-eur").val(),stock:$("#variant-edit-stock").val()}}).done(function(t){showNotification(t.message,"success",!0)}).fail(function(t){showNotification(t.responseJSON.message,"danger")})}),$("#variantEditModal").on("shown.bs.modal",function(t){$("#variant-edit-title").focus(),$("#variant-edit-id").val($(t.relatedTarget).data("id")),$("#variant-edit-title").val($(t.relatedTarget).data("title")),$("#variant-edit-price").val($(t.relatedTarget).data("price")),$("#variant-edit-price-cfa").val($(t.relatedTarget).data("productpricecfa")),$("#variant-edit-price-usd").val($(t.relatedTarget).data("productpriceusd")),$("#variant-edit-price-eur").val($(t.relatedTarget).data("productpriceeur")),$("#variant-edit-stock").val($(t.relatedTarget).data("stock"))}),$(document).on("click","#addVariant",function(t){$.ajax({method:"POST",url:"/admin/product/addvariant",data:{product:$("#variant-product").val(),title:$("#variant-title").val(),price:$("#variant-price").val(),productPriceUSD:$("#variant-price-usd").val(),productPriceCFA:$("#variant-price-cfa").val(),productPriceEUR:$("#variant-price-eur").val(),stock:$("#variant-stock").val()}}).done(function(t){showNotification(t.message,"success",!0)}).fail(function(t){showNotification(t.responseJSON.message,"danger")})}),$(document).on("click","#btnSettingsUpdate",function(t){$("#settingsForm").submit()}),$("#settingsForm").validator().on("submit",function(t){t.isDefaultPrevented()||(t.preventDefault(),$("#footerHtml_input").val($(".CodeMirror")[0].CodeMirror.getValue()),$("#googleAnalytics_input").val($(".CodeMirror")[1].CodeMirror.getValue()),$("#customCss_input").val($(".CodeMirror")[2].CodeMirror.getValue()),$.ajax({method:"POST",url:"/admin/settings/update",data:$("#settingsForm").serialize()}).done(function(t){showNotification(t.message,"success")}).fail(function(t){showNotification(t.responseJSON.message,"danger")}))}),$(document).on("click","#orderStatusUpdate",function(t){$.ajax({method:"POST",url:"/admin/order/statusupdate",data:{order_id:$("#order_id").val(),status:$("#orderStatus").val()}}).done(function(t){showNotification(t.message,"success",!0)}).fail(function(t){showNotification(t.responseJSON.message,"danger")})}),$(document).on("click","#btnUserAdd",function(t){$("#userNewForm").submit()}),$("#userNewForm").validator().on("submit",function(t){t.isDefaultPrevented()||(t.preventDefault(),$.ajax({method:"POST",url:"/admin/user/insert",data:{usersName:$("#usersName").val(),userEmail:$("#userEmail").val(),userPassword:$("#userPassword").val()}}).done(function(t){showNotification(t.message,"success",!1,"/admin/user/edit/"+t.userId)}).fail(function(t){showNotification(t.responseJSON.message,"danger")}))}),$(".userDelete").on("click",function(){confirm("Are you sure you want to delete?")&&$.ajax({method:"POST",url:"/admin/user/delete",data:{userId:$(this).attr("data-id")}}).done(function(t){showNotification(t.message,"success",!0)}).fail(function(t){showNotification(t.responseJSON.message,"danger")})}),$(document).on("click","#btnUserEdit",function(t){$("#userEditForm").submit()}),$("#userEditForm").validator().on("submit",function(t){t.isDefaultPrevented()||(t.preventDefault(),$.ajax({method:"POST",url:"/admin/user/update",data:{userId:$("#userId").val(),usersName:$("#usersName").val(),userEmail:$("#userEmail").val(),userPassword:$("#userPassword").val(),userAdmin:$("#userPassword").is(":checked")}}).done(function(t){showNotification(t.message,"success")}).fail(function(t){showNotification(t.responseJSON.message,"danger")}))}),$("#productNewForm").validator().on("submit",function(t){t.isDefaultPrevented()||(t.preventDefault(),""===$("#productPermalink").val()&&""!==$("#productTitle").val()&&$("#productPermalink").val(slugify($("#productTitle").val())),console.log({productTitle:$("#productTitle").val(),productPrice:$("#productPrice").val(),productPriceUSD:$("#productPriceUSD").val(),productPriceCFA:$("#productPriceCFA").val(),productPriceEUR:$("#productPriceEUR").val(),productPublished:$("#productPublished").val(),productStock:$("#productStock").val(),productDescription:$("#productDescription").val(),productGtin:$("#productGtin").val(),productBrand:$("#productBrand").val(),productPermalink:$("#productPermalink").val(),productSubscription:$("#productSubscription").val(),productComment:$("#productComment").is(":checked"),productTags:$("#productTags").val(),productCapsizes:$("#multiselect").val().join(", "),productColors:$("#colorInput").val()}),$.ajax({method:"POST",url:"/admin/product/insert",data:{productTitle:$("#productTitle").val(),productPrice:$("#productPrice").val(),productPriceUSD:$("#productPriceUSD").val(),productPriceCFA:$("#productPriceCFA").val(),productPriceEUR:$("#productPriceEUR").val(),productPublished:$("#productPublished").val(),productStock:$("#productStock").val(),productDescription:$("#productDescription").val(),productGtin:$("#productGtin").val(),productBrand:$("#productBrand").val(),productPermalink:$("#productPermalink").val(),productSubscription:$("#productSubscription").val(),productComment:$("#productComment").is(":checked"),productTags:$("#productTags").val(),productCapsizes:$("#multiselect").val().join(", "),productColors:$("#colorInput").val()}}).done(function(t){showNotification(t.message,"success",!1,"/admin/product/edit/"+t.productId)}).fail(function(t){if(t.responseJSON.length>0){var e=validationErrors(t.responseJSON);return $("#validationModalBody").html(e),void $("#validationModal").modal("show")}showNotification(t.responseJSON.message,"danger")}))}),$("#tagsMenuForm").on("submit",function(t){if(!t.isDefaultPrevented()){t.preventDefault();const e=$(".tag-selected"),a=[];e.filter(t=>{e[t].checked&&a.push(e[t].value)}),$.ajax({method:"POST",url:"/admin/menu-tags/insert",data:{selectedTags:a}}).done(function(t){showNotification(t.message,"success",!1,"/admin/settings/tag-links/")}).fail(function(t){400===t.status?showNotification(t.responseJSON.msg,"danger"):showNotification("Please refresh and try again","danger")})}}),$("#IGPostsForm").on("submit",function(t){t.isDefaultPrevented()||(t.preventDefault(),$.ajax({method:"POST",url:"/admin/ig-posts/insert",data:{igPostOne:$("#igPostOne").val(),igPostTwo:$("#igPostTwo").val(),igPostThree:$("#igPostThree").val()}}).done(function(t){showNotification(t.message,"success",!1,"/admin/settings/ig-posts/")}).fail(function(t){400===t.status?showNotification(t.responseJSON.msg,"danger"):showNotification("Please confirm your URLs and try again","danger")}))}),$("#productEditForm").validator().on("submit",function(t){if(!t.isDefaultPrevented()){t.preventDefault(),""===$("#productPermalink").val()&&""!==$("#productTitle").val()&&$("#productPermalink").val(slugify($("#productTitle").val()));const e=$("#colorInput2").val()?JSON.parse($("#colorInput2").val()):{};$("input:checkbox[name=colors]:checked").each(function(){const t={name:$(this).val(),color:$(this).data("color")};e[t.name]||(e[t.name]=t.color)});const a=JSON.stringify(e);$.ajax({method:"POST",url:"/admin/product/update",data:{productId:$("#productId").val(),productTitle:$("#productTitle").val(),productPrice:$("#productPrice").val(),productPriceUSD:$("#productPriceUSD").val(),productPriceCFA:$("#productPriceCFA").val(),productPriceEUR:$("#productPriceEUR").val(),productPublished:$("#productPublished").val(),productStock:$("#productStock").val(),productStockDisable:$("#productStockDisable").is(":checked"),productDescription:$("#productDescription").val(),productGtin:$("#productGtin").val(),productBrand:$("#productBrand").val(),productPermalink:$("#productPermalink").val(),productSubscription:$("#productSubscription").val(),productComment:$("#productComment").is(":checked"),productTags:$("#productTags").val(),productCapsizes:$("#multiselect2").val().join(", "),productColors:a}}).done(function(t){showNotification(t.message,"success",!0)}).fail(function(t){if(t.responseJSON.length>0){var e=validationErrors(t.responseJSON);return console.log("errorMessages",e),$("#validationModalBody").html(e),void $("#validationModal").modal("show")}showNotification(t.responseJSON.message,"danger")})}}),$(".set-as-main-image").on("click",function(){$.ajax({method:"POST",url:"/admin/product/setasmainimage",data:{product_id:$("#productId").val(),productImage:$(this).attr("data-id")}}).done(function(t){showNotification(t.message,"success",!0)}).fail(function(t){showNotification(t.responseJSON.message,"danger")})}),$(".btn-delete-image").on("click",function(){confirm("Are you sure you want to delete this image?")&&$.ajax({method:"POST",url:"/admin/product/deleteimage",data:{product_id:$("#productId").val(),productImage:$(this).attr("data-id")}}).done(function(t){showNotification(t.message,"success",!0)}).fail(function(t){showNotification(t.responseJSON.message,"danger")})}),$(".btn-delete-product").on("click",function(){confirm("Are you sure you want to delete this product?")&&$.ajax({method:"POST",url:"/admin/product/delete",data:{productId:$(this).attr("data-id")}}).done(function(t){showNotification(t.message,"success",!0)}).fail(function(t){showNotification(t.responseJSON.message,"danger")})}),$(".btn-delete-review").on("click",function(){confirm("Are you sure you want to delete this review?")&&$.ajax({method:"POST",url:"/admin/review/delete",data:{reviewId:$(this).attr("data-id")}}).done(function(t){showNotification(t.message,"success",!0)}).fail(function(t){showNotification(t.responseJSON.message,"danger")})}),$(document).on("click","#validatePermalink",function(t){""!==$("#productPermalink").val()?$.ajax({method:"POST",url:"/admin/validatePermalink",data:{permalink:$("#productPermalink").val(),docId:$("#productId").val()}}).done(function(t){showNotification(t.message,"success")}).fail(function(t){showNotification(t.responseJSON.message,"danger")}):showNotification("Please enter a permalink to validate","danger")}),$(document).on("click","#btn_product_filter",function(t){""!==$("#product_filter").val()?window.location.href="/admin/products/filter/"+$("#product_filter").val():showNotification("Please enter a keyword to filter","danger")}),$(document).on("click","#btn_order_filter",function(t){""!==$("#order_filter").val()?window.location.href="/admin/orders/filter/"+$("#order_filter").val():showNotification("Please enter a keyword to filter","danger")}),$(document).on("click","#btn_customer_filter",function(t){""!==$("#customer_filter").val()?window.location.href="/admin/customers/filter/"+$("#customer_filter").val():showNotification("Please enter a keyword to filter","danger")}),$(document).on("click","#btn_review_filter",function(t){""!==$("#review_filter").val()?window.location.href="/admin/reviews/filter/"+$("#review_filter").val():showNotification("Please enter a keyword to filter","danger")}),$(document).on("click","#lookupCustomer",function(t){t.preventDefault(),$.ajax({method:"POST",url:"/admin/customer/lookup",data:{customerEmail:$("#customerEmail").val()}}).done(function(t){showNotification(t.message,"success"),$("#orderFirstName").val(t.customer.firstName),$("#orderLastName").val(t.customer.lastName),$("#orderAddress1").val(t.customer.address1),$("#orderAddress2").val(t.customer.address2),$("#orderCountry").val(t.customer.country),$("#orderState").val(t.customer.state),$("#orderPostcode").val(t.customer.postcode),$("#orderPhone").val(t.customer.phone)}).fail(function(t){showNotification(t.responseJSON.message,"danger")})}),$(document).on("click","#orderCreate",function(t){t.preventDefault(),0===$("#createOrderForm").validator("validate").has(".has-error").length&&$.ajax({method:"POST",url:"/admin/order/create",data:{orderStatus:$("#orderStatus").val(),email:$("#customerEmail").val(),firstName:$("#orderFirstName").val(),lastName:$("#orderLastName").val(),address1:$("#orderAddress1").val(),address2:$("#orderAddress2").val(),country:$("#orderCountry").val(),state:$("#orderState").val(),postcode:$("#orderPostcode").val(),phone:$("#orderPhone").val(),orderComment:$("#orderComment").val()}}).done(function(t){showNotification(t.message,"success"),window.location=`/admin/order/view/${t.orderId}`}).fail(function(t){showNotification(t.responseJSON.message,"danger")})}),$("#sendTestEmail").on("click",function(t){t.preventDefault(),$.ajax({method:"POST",url:"/admin/testEmail"}).done(function(t){showNotification(t,"success")}).fail(function(t){showNotification(t.responseJSON.message,"danger")})}),$(document).on("click",".orderFilterByStatus",function(t){t.preventDefault(),window.location="/admin/orders/bystatus/"+$("#orderStatusFilter").val()}),$('input[class="publishedState"]').change(function(){$.ajax({method:"POST",url:"/admin/product/publishedState",data:{id:this.id,state:this.checked}}).done(function(t){showNotification(t.message,"success")}).fail(function(t){showNotification(t.responseJSON.message,"danger")})}),$("#updateCustomer").validator().on("click",function(t){t.preventDefault(),0===$("#customer-form").validator("validate").has(".has-error").length&&$.ajax({method:"POST",url:"/admin/customer/update",data:{customerId:$("#customerId").val(),email:$("#email").val(),firstName:$("#firstName").val(),lastName:$("#lastName").val(),address1:$("#address1").val(),address2:$("#address2").val(),country:$("#country").val(),state:$("#state").val(),postcode:$("#postcode").val(),phone:$("#phone").val()}}).done(function(t){showNotification(t.message,"success")}).fail(function(t){showNotification(t.responseJSON.message,"danger")})}),$("#deleteCustomer").on("click",function(t){t.preventDefault(),$.ajax({method:"DELETE",url:"/admin/customer",data:{customerId:$("#customerId").val()}}).done(function(t){showNotification(t.message,"success",!1,"/admin/customers")}).fail(function(t){showNotification(t.responseJSON.message,"danger")})}),$("#footerHtml").length){var t=window.CodeMirror.fromTextArea(document.getElementById("footerHtml"),{mode:"xml",tabMode:"indent",theme:"flatly",lineNumbers:!0,htmlMode:!0,fixedGutter:!1});t.setValue(t.getValue())}if($("#googleAnalytics").length&&window.CodeMirror.fromTextArea(document.getElementById("googleAnalytics"),{mode:"xml",tabMode:"indent",theme:"flatly",lineNumbers:!0,htmlMode:!0,fixedGutter:!1}),$("#customCss").length){var e=window.CodeMirror.fromTextArea(document.getElementById("customCss"),{mode:"text/css",tabMode:"indent",theme:"flatly",lineNumbers:!0}),a=window.cssbeautify(e.getValue(),{indent:"   ",autosemicolon:!0});e.setValue(a)}$(document).on("click","#btnPageUpdate",function(t){t.preventDefault(),$.ajax({method:"POST",url:"/admin/settings/page",data:{pageId:$("#pageId").val(),pageName:$("#pageName").val(),pageSlug:$("#pageSlug").val(),pageEnabled:$("#pageEnabled").is(":checked"),pageContent:$("#pageContent").val()}}).done(function(t){showNotification(t.message,"success",!0)}).fail(function(t){showNotification(t.responseJSON.message,"danger")})}),$(document).on("click","#btnPageDelete",function(t){t.preventDefault(),confirm("Are you sure?")&&$.ajax({method:"POST",url:"/admin/settings/page/delete",data:{pageId:$(this).attr("data-id")}}).done(function(t){showNotification(t.message,"success",!0)}).fail(function(t){showNotification(t.message,"danger",!0)})}),$("#discountNewForm").validator().on("submit",function(t){t.isDefaultPrevented()||(t.preventDefault(),$.ajax({method:"POST",url:"/admin/settings/discount/create",data:{code:$("#discountCode").val(),type:$("#discountType").val(),value:$("#discountValue").val(),start:$("#discountStart").val(),end:$("#discountEnd").val()}}).done(function(t){showNotification(t.message,"success",!1,"/admin/settings/discount/edit/"+t.discountId)}).fail(function(t){showNotification(t.responseJSON.message,"danger")}))}),$("#discountEditForm").validator().on("submit",function(t){t.isDefaultPrevented()||(t.preventDefault(),$.ajax({method:"POST",url:"/admin/settings/discount/update",data:{discountId:$("#discountId").val(),code:$("#discountCode").val(),type:$("#discountType").val(),value:$("#discountValue").val(),start:$("#discountStart").val(),end:$("#discountEnd").val()}}).done(function(t){showNotification(t.message,"success")}).fail(function(t){showNotification(t.responseJSON.message,"danger")}))}),$("#discountStart").datetimepicker({uiLibrary:"bootstrap4",footer:!0,modal:!0,format:"dd/mm/yyyy HH:MM",showOtherMonths:!0}),$("#discountEnd").datetimepicker({uiLibrary:"bootstrap4",footer:!0,modal:!0,format:"dd/mm/yyyy HH:MM"}),$(document).on("click","#btnDiscountDelete",function(t){t.preventDefault(),confirm("Are you sure?")&&$.ajax({method:"DELETE",url:"/admin/settings/discount/delete",data:{discountId:$(this).attr("data-id")}}).done(function(t){showNotification(t.message,"success",!0)}).fail(function(t){showNotification(t.message,"danger",!0)})}),$(document).on("click","#settings-menu-new",function(t){t.preventDefault(),$.ajax({method:"POST",url:"/admin/settings/menu/new",data:{navMenu:$("#newNavMenu").val(),navLink:$("#newNavLink").val()}}).done(function(t){showNotification(t.message,"success",!0)}).fail(function(t){showNotification(t.message,"danger",!0)})}),$(document).on("click","#settings-menu-update",function(t){t.preventDefault();var e=$(this).attr("data-id"),a=$("#menuId-"+e);$.ajax({method:"POST",url:"/admin/settings/menu/update",data:{navId:a.find(".navId").val(),navMenu:a.find(".navMenu").val(),navLink:a.find(".navLink").val()}}).done(function(t){showNotification(t.message,"success",!0)}).fail(function(t){showNotification(t.message,"danger",!0)})}),$(document).on("click",".settings-menu-delete",function(t){t.preventDefault(),confirm("Are you sure?")&&$.ajax({method:"POST",url:"/admin/settings/menu/delete",data:{menuId:$(this).attr("data-id")}}).done(function(t){showNotification(t.message,"success",!0)}).fail(function(t){showNotification(t.message,"danger",!0)})}),$("#draggable_list").length&&$("#draggable_list").sortable({update:function(){var t=[];$(".navId").each(function(e){t.push($($(".navId")[e]).val())}),$.ajax({data:{order:t},type:"POST",url:"/admin/settings/menu/saveOrder"}).done(function(){showNotification("Menu order saved","success",!0)}).fail(function(t){showNotification(t.responseJSON.message,"danger",!0)})}}),$(document).on("click","#uploadButton",function(t){t.preventDefault();var e=new FormData($("#uploadForm")[0]);e.append("productId",$("#productId").val()),$.ajax({method:"POST",url:"/admin/file/upload",processData:!1,contentType:!1,cache:!1,data:e}).done(function(t){showNotification(t.message,"success",!0)}).fail(function(t){showNotification(t.responseJSON.message,"danger")})}),$("#global-search-value").on("keyup",t=>{""===$("#global-search-value").val()&&($("#global-search-results").empty(),$("#global-search-results").addClass("invisible"));let e=3;/^\d*\.?\d*$/.test($("#global-search-value").val())&&(e=1),$("#global-search-value").val().length>e&&($("#global-search").html('<span class="fa fa-spinner fa-spin"></span>'),globalSearch())}),$("#globalSearchModal").on("shown.bs.modal",function(){$("#global-search-value").focus()}),$("body").on("click",".gr-click",t=>{$("#global-search-value").val();const e=$(t.currentTarget).closest(".global-result").attr("data-url");e&&(window.location=e)})});