{{> partials/menu}}
<main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
	<form class="form-horizontal" id="productNewForm" data-toggle="validator">
		<div class="col-12">
			<div class="page-header">
				<div class="float-right">
					<button id="frm_edit_product_save" class="btn btn-outline-success" type="submit">Add product</button>
					<button id="frm_edit_product_test" class="btn btn-outline-success" type="button">Test product</button>
				</div>
				<h2>{{ @root.__ "New product" }}</h2>
			</div>
		</div>
		<div class="col-12">
			<div class="form-group">
				<label for="productTitle" class="control-label">{{ @root.__ "Product title" }} *</label>
				<input type="text" id="productTitle" class="form-control" minlength="5" maxlength="200" value="{{productTitle}}"
					required />
			</div>
		</div>
		<div class="row ml-0 mr-0">
			<div class="col-sm-4">
				<div class="form-group">
					<label for="productPrice" class="control-label">{{ @root.__ "Product price" }} *</label>
					<div class="input-group">
						<div class="input-group-prepend">
							<label class="input-group-text">{{currencySymbol config.currencySymbol}}</label>
						</div>
						<input type="number" id="productPrice" class="form-control" step="any" value="{{productPrice}}" required />
					</div>
				</div>
			</div>
			<div class="col-sm-4">
				<div class="form-group">
					<label for="productGtin" class="control-label">{{ @root.__ "Product GTIN" }}</label>
					<div class="input-group">
						<input type="number" id="productGtin" class="form-control" step="any" value="{{productGtin}}" />
					</div>
					<p class="help-block">{{ @root.__ "The Serial number, GTIN or Barcode" }}</p>
				</div>
			</div>
			<div class="col-sm-4">
				<div class="form-group">
					<label for="productBrand" class="control-label">{{ @root.__ "Product Brand" }}</label>
					<div class="input-group">
						<input type="text" id="productBrand" class="form-control" value="{{productBrand}}" />
					</div>
					<p class="help-block">{{ @root.__ "The brand of the product" }}</p>
				</div>
			</div>
		</div>
		<div class="row ml-0 mr-0">
			<div class="col-sm-4">
				<div class="form-group">
					<label for="productPriceUSD" class="control-label">{{ @root.__ "Product price USD" }} *</label>
					<div class="input-group">
						<div class="input-group-prepend">
							<label class="input-group-text">USD</label>
						</div>
						<input type="number" id="productPriceUSD" class="form-control" step="any" value="{{productPriceUSD}}"
							required />
					</div>
				</div>
			</div>
			<div class="col-sm-4">
				<div class="form-group">
					<label for="productPriceCFA" class="control-label">{{ @root.__ "Product price CFA" }} *</label>
					<div class="input-group">
						<div class="input-group-prepend">
							<label class="input-group-text">CFA</label>
						</div>
						<input type="number" id="productPriceCFA" class="form-control" step="any" value="{{productPriceCFA}}"
							required />
					</div>
				</div>
			</div>
			<div class="col-sm-4">
				<div class="form-group">
					<label for="productPriceEUR" class="control-label">{{ @root.__ "Product price EUR" }} *</label>
					<div class="input-group">
						<div class="input-group-prepend">
							<label class="input-group-text">EUR</label>
						</div>
						<input type="number" id="productPriceEUR" class="form-control" step="any" value="{{productPriceEUR}}"
							required />
					</div>
				</div>
			</div>
		</div>
		<div class="row ml-0 mr-0">
			<div class="col-sm-4">
				<div class="form-group">
					<label for="productCapsize" class="control-label">{{ @root.__ "Product Capsize" }} *</label>
					<div class="input-group">
						<div class="input-group-prepend">
							<label class="input-group-text">Size</label>
						</div>
						<select id="multiselect" multiple="multiple">
							<option value="sm">Small</option>
							<option value="md">Medium</option>
							<option value="lg">Large</option>
							<option value="xl">Extra Large</option>
						</select>
					</div>
				</div>
			</div>
			<div class="col-sm-8">
				<div class="form-group">
					<label for="productColor" class="control-label">{{ @root.__ "Product Color" }} *</label>
					<div class="input-group">
						<input type="text" id="productColor" class="form-control" placeholder="Color name" />
						<span class="color-picker">
							<label for="colorPicker">
								<input type="color" value="#1DB8CE" id="colorPicker">
							</label>
						</span>
						<button id="addColorBtn" type="button" class="btn btn-sm btn-primary">
							Add
						</button>
					</div>
				</div>
				<input type="text" style="display: none;" id="colorInput">
				<div class="form-group" id="productColorChips">
					{{!-- <div class="md-chip">
						<span>Chip chip chip</span>
						<button type="button" class="md-chip-remove">
						</button>
					</div> --}}
				</div>
			</div>
		</div>
		<div class="row ml-0 mr-0">
			<div class="col-sm-6">
				<div class="form-group">
					<label for="productPublished" class="control-label">{{ @root.__ "Status" }}</label>
					<select class="form-control" id="productPublished">
						<option value="true" selected>{{ @root.__ "Published" }}</option>
						<option value="false">{{ @root.__ "Draft" }}</option>
					</select>
				</div>
			</div>
			{{#if config.trackStock}}
			<div class="col-sm-6">
				<div class="form-group">
					<label for="productStock" class="control-label">{{ @root.__ "Stock level" }}</label>
					<input type="number" id="productStock" class="form-control" value="{{productStock}}" step="any" />
				</div>
			</div>
		</div>
		{{/if}}
		<div class="col-12">
			<div class="form-group" id="editor-wrapper">
				<label for="editor" class="control-label">{{ @root.__ "Product description" }} *</label>
				<textarea minlength="5" rows="10" id="productDescription" class="form-control"
					required>{{productDescription}}</textarea>
			</div>
		</div>
		<div class="col-12">
			<div class="form-group">
				<label class="control-label">Permalink</label>
				<div class="input-group">
					<input type="text" class="form-control" id="productPermalink" placeholder="Permalink for the article"
						value={{productPermalink}}>
					<div class="input-group-append">
						<button class="btn btn-outline-success" id="validatePermalink" type="button">Validate</button>
					</div>
				</div>
				<p class="help-block">{{ @root.__ "This sets a readable URL for the product" }}</p>
			</div>
		</div>
		{{#contains config.paymentGateway 'stripe'}}
		<div class="col-12">
			<div class="form-group">
				<label class="control-label">Subscription plan</label>
				<input type="text" class="form-control" id="productSubscription" placeholder="plan_XXXXXXXXXXXXXX">
				<p class="help-block">First setup the plan in <strong>Stripe</strong> dashboard and enter the Plan ID. Format:
					plan_XXXXXXXXXXXXXX</p>
			</div>
		</div>
		{{/contains}}
		<div class="col-12">
			<div class="form-group">
				<label for="productComment" class="control-label">{{ @root.__ "Allow comment" }}</label>
				<div class="checkbox">
					<label>
						<input class="productComment" type="checkbox" {{checkedState result.productComment}} id="productComment">
					</label>
				</div>
				<p class="help-block">{{ @root.__ "Allow free form comments when adding products to cart" }}</p>
			</div>
		</div>
		<div class="col-12">
			<div class="form-group">
				<label for="productTags" class="control-label">Product tag words</label>
				<input type="text" class="form-control" id="productTags">
				<p class="help-block">
					{{ @root.__ "Tag words used to indexed products, making them easier to find and filter." }}</p>
			</div>
		</div>
	</form>
</main>
<script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.2/summernote.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.2/summernote.css" rel="stylesheet">
<script>
	$(document).ready(function () {
		$('#productDescription').summernote({
			height: 300,
			minHeight: null
		});

		$(document).ready(function () {

			$('#multiselect').multiselect({
				buttonWidth: '200px',
				includeSelectAllOption: true,
				nonSelectedText: 'Sizes'
			});

			function getSelectedValues() {
				var selectedVal = $("#multiselect").val();
				for (var i = 0; i < selectedVal.length; i++) {
					if (window.CP.shouldStopExecution(0)) break;
					function innerFunc(i) {
						setTimeout(function () {
							location.href = selectedVal[i];
						}, i * 2000);
					}
					innerFunc(i);
				} window.CP.exitedLoop(0);
			}

			document.querySelectorAll('input[type=color]').forEach(function (picker) {

				var targetLabel = document.querySelector('label[for="' + picker.id + '"]'),
					codeArea = document.createElement('span');

				codeArea.innerHTML = picker.value;
				targetLabel.appendChild(codeArea);

				picker.addEventListener('change', function () {
					codeArea.innerHTML = picker.value;
					targetLabel.appendChild(codeArea);
				});
			});

			let productColors = {}

			$('#addColorBtn').on('click', function (e) {
				e.preventDefault()


				const color = {
					name: $("#productColor").val(),
					color: $("#colorPicker").val()
				}

				if (productColors[color.name] || color.name == '') return

				const newChip = `
					<div class="md-chip" style='border: 2px solid ${color.color}'>
						<span>${color.name}</span>
						<button type="button" data-color="${color.name}" class="md-chip-remove">
						</button>
					</div>
				`

				$('#productColorChips').append(newChip)

				if (color.name.trim() == '') return
				else {
					productColors[color.name] = color.color
					$('#colorInput').val(JSON.stringify(productColors))
					$("#productColor").val('')
				}
			})

			$(document).on("click", "button.md-chip-remove", function (e) {
				const color = $(this).attr("data-color")
				//const colorIndex = productColors.findIndex(c => c.name == color)
				if (productColors[color]) {
					delete productColors[color]
					//productColors.splice(colorIndex, 1)
					$(this).parent().remove();

					$('#colorInput').val(JSON.stringify(productColors))
				}
			});
		})
	});

	//productColorChips
</script>